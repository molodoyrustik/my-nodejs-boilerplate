{"version":3,"file":null,"sources":["../src/config/index.js","../src/middlewares/accessLogger.js","../src/middlewares/reqParser.js","../src/middlewares/catchError.js","../src/middlewares/reqLog.js","../src/middlewares/extendReqRes.js","../src/middlewares/index.js","../src/models/Domain/LogSchema.js","../src/models/Domain/DomainSchema.js","../src/models/Channel/ChannelSchema.js","../src/models/User/User.js","../src/models/Token/Token.js","../src/models/Domain/Domain.js","../src/models/Channel/Channel.js","../src/models/Rate/Rate.js","../src/models/index.js","../src/controllers/Auth/Auth.js","../src/controllers/Domain/Domain.js","../src/controllers/Channel/Channel.js","../src/controllers/index.js","../src/utils/Nodemailer/index.js","../src/utils/index.js","../src/api/auth/auth.js","../src/api/domain/domain.js","../src/api/channel/channel.js","../src/api/api.js","../src/App.js","../src/index.js"],"sourcesContent":["global.__DEV__ = true;\n// __STAGE__\nglobal.__PROD__ = false;\n\nexport default {\n  name: 'Your super app',\n  port: 3001,\n  db: {\n    url: 'mongodb://localhost/test',\n  },\n  jwt: {\n    secret: 'YOUR_SECRET',\n  },\n  nodemailer: {\n    service: 'mail',\n    host: 'smtp.mail.ru',\n    auth: {\n      user: 'molodoyrustik@mail.ru',\n      pass: 'molodoy'\n    }\n  },\n};\n","import leftPad from 'left-pad';\n\nfunction levelFn(data) {\n  if (data.err || data.status >= 500 || data.duration > 10000) { // server internal error or error\n    return 'error';\n  } else if (data.status >= 400 || data.duration > 3000) { // client error\n    return 'warn';\n  }\n  return 'info';\n}\n\nfunction logStart(data) {\n  return `${leftPad(data.method, 4)} ${data.url} started reqId=${data.reqId}`;\n}\n\nfunction logFinish(data) {\n  const time = (data.duration || 0).toFixed(3);\n  const length = data.length || 0;\n  return `${leftPad(data.method, 4)} ${data.url} ${leftPad(data.status, 3)} ${leftPad(time, 7)}ms ${leftPad(length, 5)}b reqId=${data.reqId}`;\n}\n\nexport default (params) => ([\n  (req, res, next) => {\n    const data = {}\n    if (!req.log) throw 'has no req.log!'\n    const log = req.log.child({\n      component: 'req',\n    });\n\n    data.reqId = req.reqId\n    data.method = req.method\n    if (req.ws) data.method = 'WS'\n    data.host = req.headers.host\n    data.url = (req.baseUrl || '') + (req.url || '-')\n    data.referer = req.header('referer') || req.header('referrer')\n    data.ip = req.ip || req.connection.remoteAddress ||\n        (req.socket && req.socket.remoteAddress) ||\n        (req.socket.socket && req.socket.socket.remoteAddress) ||\n        '127.0.0.1'\n\n\n    if (__DEV__) {\n      log.debug(data, logStart(data));\n      if (req.body) {\n        log.trace(JSON.stringify(req.body));\n      }\n    }\n\n    const hrtime = process.hrtime();\n    function logging() {\n      data.status = res.statusCode\n      data.length = res.getHeader('Content-Length')\n\n      const diff = process.hrtime(hrtime);\n      data.duration = diff[0] * 1e3 + diff[1] * 1e-6\n\n      log[levelFn(data)](data, logFinish(data));\n    }\n    res.on('finish', logging);\n    res.on('close', logging);\n    next();\n  }\n])\n","import cookieParser from 'cookie-parser'\nimport bodyParser from 'body-parser'\nimport cors from 'cors'\n\nexport default (ctx) => ([\n  bodyParser.json(),\n  bodyParser.urlencoded({ extended: true }),\n  cookieParser(),\n  cors(),\n])\n","export default (ctx) => (\n  (err, req, res, next) => {\n    if(req && req.log && req.log.error){\n      req.log.error({\n        err,\n        query: req.query,\n        body: req.body,\n        headers: req.headers\n      }, (err || {}).stack)\n    } else {\n      console.log(err)\n    }\n    res.status(err.status || 500)\n    return res.json([]);\n    if (res.err) return res.err(err)\n    return res.json(err)\n  }\n)\n","import uuid from 'uuid'\n\nexport default (params) => ([\n  (req, res, next) => {\n    if (__PROD__) {\n      req.reqId = uuid.v4()\n    } else {\n      global.reqId = 1 + (global.reqId || 0)\n      req.reqId = global.reqId\n    }\n    if (params.log) {\n      req.log = params.log.child({\n        reqId: req.reqId,\n      });\n    }\n    next()\n  },\n])\n","import _ from 'lodash'\nexport default (ctx) => ([\n  (req, res, next) => {\n    if (ctx.requests) {\n      _.forEach(ctx.requests, (val, key) => {\n        req[key] = val.bind(req)\n      })\n      // if (req.allParams) {\n      //   req.params = req.allParams.bind(req)()\n      // }\n    }\n    if (ctx.responses) {\n      _.forEach(ctx.responses, (val, key) => {\n        res[key] = val.bind(res)\n      })\n    }\n    next()\n  }\n])\n","// fs\nimport accessLogger from './accessLogger'\nimport reqParser from './reqParser'\nimport catchError from './catchError'\nimport reqLog from './reqLog'\nimport extendReqRes from './extendReqRes'\n\nexport default function (ctx) {\n  return {\n    accessLogger: accessLogger(...arguments),\n    reqParser: reqParser(...arguments),\n    catchError: catchError(...arguments),\n    reqLog: reqLog(...arguments),\n    extendReqRes: extendReqRes(...arguments),\n  }\n}\n","import mongoose from 'mongoose'\r\n\r\nconst LogSchema = new mongoose.Schema({\r\n  id: {\r\n    type: String,\r\n    trim: true,\r\n  },\r\n  successRequests: [],\r\n  errorRequests: [],\r\n})\r\n\r\nexport default LogSchema\r\n","import _ from 'lodash'\r\nimport mongoose from 'mongoose'\r\n\r\nimport LogSchema from './LogSchema';\r\n\r\nconst DomainSchema = new mongoose.Schema({\r\n  id: {\r\n    type: String,\r\n    trim: true,\r\n  },\r\n  url: {\r\n    type: String,\r\n    trim: true,\r\n  },\r\n  channels: [],\r\n  logs: [LogSchema],\r\n})\r\n\r\nexport default DomainSchema\r\n","import _ from 'lodash'\r\nimport mongoose from 'mongoose'\r\n\r\nconst ChannelSchema = new mongoose.Schema({\r\n  id: {\r\n    type: String,\r\n    trim: true,\r\n  },\r\n  type: {\r\n    type: String,\r\n    trim: true,\r\n  },\r\n  endpoint: {\r\n    type: String,\r\n    trim: true,\r\n  }\r\n})\r\n\r\nexport default ChannelSchema;\r\n","import _ from 'lodash'\nimport jwt from 'jsonwebtoken'\nimport bcrypt from 'bcryptjs'\nimport Promise from 'bluebird'\nconst bcryptGenSalt = Promise.promisify(bcrypt.genSalt)\nconst bcryptHash = Promise.promisify(bcrypt.hash)\nconst bcryptCompare = Promise.promisify(bcrypt.compare)\nimport mongoose from 'mongoose'\nimport uniqid from 'uniqid';\n\nimport DomainSchema from '../Domain/DomainSchema';\nimport ChannelSchema from '../Channel/ChannelSchema';\n\nexport default (ctx) => {\n  if (!ctx.log) throw '!log'\n\n  const schema = new mongoose.Schema({\n    email: {\n      type: String,\n      required: true,\n      trim: true,\n    },\n    id: {\n      type: String,\n      trim: true,\n    },\n    password: {\n      type: String,\n    },\n    domains: [DomainSchema],\n    channels: [ChannelSchema],\n  }, {\n    collection: 'user',\n    timestamps: true,\n  })\n\n  schema.statics.isValidEmail = function (email) {\n    const re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email)\n  }\n  schema.statics.generatePassword = function (length = 10) {\n    return Math.random().toString(36).substr(2, length)\n  }\n  schema.methods.toJSON = function () {\n    return _.omit(this.toObject(), ['password'])\n  }\n  schema.methods.getIdentity = function (params) {\n    const object = _.pick(this.toObject(), ['_id', 'email', 'id'])\n    if (!params) return object\n    return Object.assign(object, params)\n  }\n  schema.methods.generateAuthToken = function (params) {\n    return jwt.sign(this.getIdentity(params), ctx.config.jwt.secret)\n  }\n  schema.methods.verifyPassword = async function (password) {\n    return await bcryptCompare(password, this.password)\n  }\n\n  const SALT_WORK_FACTOR = 10\n  schema.pre('save', function (next) {\n    if (!this.isModified('password')) return next();\n    return bcryptGenSalt(SALT_WORK_FACTOR)\n    .then(salt => {\n      bcryptHash(this.password, salt)\n      .then(hash => {\n        this.password = hash\n        next();\n      })\n    })\n    .catch(next)\n  });\n\n  return mongoose.model('User', schema);\n}\n","import mongoose from 'mongoose'\r\n\r\nexport default (ctx) => {\r\n  if (!ctx.log) throw '!log'\r\n\r\n  const schema = new mongoose.Schema({\r\n    id: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    userID: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    forgotEmailToken: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n  }, {\r\n    collection: 'token',\r\n    timestamps: true,\r\n  })\r\n\r\n  return mongoose.model('Token', schema);\r\n}\r\n","import mongoose from 'mongoose'\r\nimport DomainSchema from './DomainSchema';\r\n\r\nexport default (ctx) => {\r\n  if (!ctx.log) throw '!log'\r\n\r\n  return  mongoose.model('Domain', DomainSchema);\r\n}\r\n","import mongoose from 'mongoose'\r\nimport ChannelSchema from './ChannelSchema';\r\n\r\nexport default (ctx) => {\r\n  if (!ctx.log) throw '!log'\r\n\r\n  return  mongoose.model('Channel', ChannelSchema);\r\n}\r\n","import _ from 'lodash'\r\nimport uniqid from 'uniqid';\r\nimport mongoose from 'mongoose';\r\n\r\n\r\nexport default (ctx) => {\r\n  if (!ctx.log) throw '!log'\r\n\r\n  const schema = new mongoose.Schema({\r\n    id: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    name: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    maxDomains: {\r\n      type: Number,\r\n    },\r\n    maxChannels: {\r\n      type: Number,\r\n    },\r\n  }, {\r\n    collection: 'rate',\r\n    timestamps: true,\r\n  })\r\n\r\n  return  mongoose.model('Rate', schema);\r\n}\r\n","import User from './User/User';\nimport Token from './Token/Token';\nimport DomainSchema from './Domain/DomainSchema';\nimport Domain from './Domain/Domain';\nimport Channel from './Channel/Channel';\nimport Rate from './Rate/Rate';\n\nexport default function () {\n  return {\n    Domain: Domain(...arguments),\n    Rate: Rate(...arguments),\n    User: User(...arguments),\n    Token: Token(...arguments),\n    Channel: Channel(...arguments),\n    scheme: {\n      DomainSchema,\n    }\n  }\n}\n","import jwt from 'express-jwt'\nimport uniqid from 'uniqid';\nimport crypto from 'crypto';\nimport mongoose from 'mongoose';\n\nexport function canonize(str) {\n  return str.toLowerCase().trim()\n}\n\nexport default (ctx) => {\n  const User = ctx.models.User;\n  const Token = ctx.models.Token;\n  const Domain = ctx.models.Domain;\n  const Channel = ctx.models.Channel;\n\n  const transporter = ctx.utils.Transporter;\n\n  const controller = {}\n\n  controller.validate = async function (req, res) {\n    if(req.user) {\n      const user = await User.findOne({id: req.user.id})\n      if (!user) return res.status(404).json([{validate: false, message: 'Пользователь не найден в базе'}]);\n      return [{\n        validate: true,\n        __pack: 1,\n        jwt: req.user,\n        user: user,\n      }]\n    }\n    return res.status(404).json([{validate: false, message: 'Пользователь не найден в базе'}]);\n  }\n\n  controller.getUserFields = function (req) {\n    return req.body;\n  }\n\n  controller.validationUserFields = function(userFields, res) {\n    let valid = {\n      isValid: false,\n      message: []\n    }\n\n    if(!userFields.captcha) {\n      valid.isValid = true;\n      valid.message = [{signup: false, message: 'Параметр captcha не передан или введен неверно'}]\n    }\n\n    if(!userFields.email || !userFields.password) {\n      valid.isValid = true;\n      valid.message = [{signup: false, message: 'Параметрs email или password не передан'}]\n    }\n\n    return valid;\n  }\n\n  controller.getUserCriteria = function (req, res) {\n    const params = req.body\n    if (params.email) {\n      return {\n        email: params.email,\n      }\n    }\n    return res.status(400).json([{signup: false, message: 'Параметр email не передан'}]);\n  }\n\n  controller.signup = async function (req, res) {\n    try {\n      const userFields = controller.getUserFields(req, res);\n      const valid = controller.validationUserFields(userFields, res);\n      if (valid.isValid) {\n        return res.status(400).json(valid.message);\n      }\n      const criteria = controller.getUserCriteria(req, res);\n\n      const existUser = await User.findOne(criteria)\n      if (existUser) return res.status(400).json([{signup: false, message: 'Такой email зарегистрирован'}]);\n\n      const channel = new Channel({\n        id: uniqid(),\n        type: 'email',\n        endpoint: userFields.email\n      });\n\n      const user = new User({\n        ...userFields,\n        channels: [\n          channel,\n        ],\n        id: uniqid(),\n      });\n\n      await user.save()\n\n      const userToken = new Token({ userID: user.id , id: uniqid(), forgotEmailToken: '' })\n      await userToken.save();\n\n      const result = [{\n        signup: true,\n        user,\n        token: user.generateAuthToken(),\n      }]\n\n      return res.json(result)\n\n    } catch(err) {\n      console.log(err);\n      return res.status(500).json(err)\n    }\n  }\n\n  controller.login = async function (req, res) {\n    const params = controller.getUserFields(req, res);\n    if (!params.password) return res.status(400).json([{login: false, message: 'Параметр password не передан'}]);\n\n    const criteria = controller.getUserCriteria(req);\n    const user = await User.findOne(criteria);\n\n    if (!user) return res.status(404).json([{login: false, message: 'Такой пользователь не найден'}]);\n    await user.save();\n\n    if (!await user.verifyPassword(params.password)) {\n      return res.status(400).json([{login: false, message: 'Переданный пароль не подходит'}]);\n    }\n\n    return res.json([{\n      __pack: 1,\n      login: true,\n      user,\n      token: user.generateAuthToken(),\n    }])\n  }\n\n  controller.forgot = async function (req, res) {\n    const params = controller.getUserFields(req, res);\n\n    if (!params.email) return res.status(400).json([{ forgot: false, message: 'Параметр email не передан' }]);\n    if (!params.captcha) return res.status(400).json([{ forgot: false, message: 'Параметр captcha не передан' }]);\n\n    const criteria = controller.getUserCriteria(req);\n    const user = await User.findOne(criteria);\n\n    if (!user) return res.status(404).json([{login: false, message: 'Пользователь с таким email не найден в базе'}]);\n\n    const token = await crypto.randomBytes(32);\n    const userToken = await Token.findOne({userID: user.id})\n    userToken.forgotEmailToken = token.toString('hex');\n    await userToken.save();\n\n\n    let siteUrl = 'http://localhost:3000/';\n    if (__PROD__) {\n      siteUrl = 'http://app.ashlie.io/';\n    }\n\n    let mailText = `Перейдите по ссылке чтобы изменить пароль ${siteUrl}auth/forgot/${userToken.forgotEmailToken}`;\n\n    var mailOptions = {\n      from: 'molodoyrustik@mail.ru',\n      to: user.email,\n      subject: 'Восстановления пароля сайта Ashile.io',\n      text: mailText\n    };\n    await transporter.sendMail(mailOptions);\n\n    const result = [{\n      __pack: 1,\n      forgot: true\n    }];\n    return res.json(result);\n  }\n\n  controller.checkForgotToken = async function (req, res) {\n    const { forgotEmailToken } = req.params;\n    if (!forgotEmailToken) {\n      return res.status(400).json([{checkForgotToken: false, message: 'Токен не был передан'}]);\n    }\n\n    const criteria = { forgotEmailToken };\n    const userToken = await Token.findOne(criteria);\n\n    if (!userToken) return res.status(404).json([{checkForgotToken: false, message: 'Пользователь с таким токеном не найден'}]);\n\n    return res.json([{\n        __pack: 1,\n        checkForgotToken: true\n    }]);\n  }\n\n  controller.reset = async function (req, res) {\n    const params = controller.getUserFields(req, res);\n    const { password, checkPassword, captcha, forgotEmailToken, } = params;\n\n    if (!password) return res.status(400).json([{reset: false, message: 'Параметр password не передан'}]);\n    if (!checkPassword) return res.status(400).json([{reset: false, message: 'Параметр checkPassword не передан'}]);\n    if (password !== checkPassword) return res.status(400).json([{reset: false, message: 'Пароли не совпадают'}]);\n    if (!captcha) return res.status(400).json([{reset: false, message: 'Параметр captcha не передан'}]);\n    if (!forgotEmailToken) return res.status(400).json([{reset: false, message: 'Параметр forgotEmailToken не передан'}]);\n\n    const criteria = { forgotEmailToken };\n    const userToken = await Token.findOne(criteria);\n    if (!userToken) return res.status(404).json([{reset: false, message: 'Не корректный токен'}]);\n    const { userID } = userToken;\n    userToken.forgotEmailToken = '';\n    await userToken.save();\n\n    const user = await User.findOne({id: userID});\n    if (!user) return res.status(404).json([{reset: false, message: 'Такой пользователь не найден'}]);\n    user.password = password;\n    await user.save();\n\n    return res.json([{\n      __pack: 1,\n      reset: true\n    }])\n  }\n\n  controller.getToken = function (req) {\n    if (req.headers.authorization && req.headers.authorization.split( ' ' )[ 0 ] === 'Bearer') {\n      return req.headers.authorization.split( ' ' )[ 1 ]\n    } else if (req.headers['x-access-token']) {\n      return req.headers['x-access-token'];\n    } else if ( req.query && req.query.token ) {\n      return req.query.token\n    } else if ( req.cookies && req.cookies.token  ) {\n      return req.cookies.token\n    }\n    if (__DEV__ && ctx.config && ctx.config.jwt && ctx.config.jwt.devToken) return ctx.config.jwt.devToken\n    return null;\n  }\n\n  controller.parseToken = function (req, res, next) {\n    const token = controller.getToken(req)\n    req.token = token\n    next()\n  }\n\n  controller.parseUser = function (req, res, next) {\n    const options = {\n      secret: ctx.config && ctx.config.jwt.secret || 'SECRET',\n      getToken: req => req.token,\n    }\n    jwt(options)(req, res, (err) => {\n      if (err) req._errJwt = err\n      next()\n    })\n  }\n\n  controller.isAuth = function (req, res, next) {\n    if (req._errJwt) return next(req._errJwt)\n    if (!req.user || !req.user._id) return res.status(401).send('!req.user')\n    next()\n  }\n\n  return controller\n}\n","import jwt from 'express-jwt'\r\nimport uniqid from 'uniqid';\r\n\r\n\r\nexport default (ctx) => {\r\n  const User = ctx.models.User;\r\n  const Domain = ctx.models.Domain;\r\n\r\n  let controller = {};\r\n\r\n  controller.domains = async function(req, res) {\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n\r\n    return res.json(user.domains);\r\n  }\r\n\r\n  controller.create = async function(req, res) {\r\n    const params = req.body\r\n    if (!params.url) {\r\n      return res.status(400).json([{signup: false, message: 'Домен не передан'}]);\r\n    }\r\n    if (!params.channels) {\r\n      return res.status(400).json([{signup: false, message: 'Каналы не переданы'}]);\r\n    }\r\n    const { url, channels } = params;\r\n\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n    const domain = new Domain({ url, id: uniqid(), channels})\r\n    user.domains.push(domain);\r\n    await user.save();\r\n\r\n    return res.json([{ flag: true, message: 'Домен успешно добавлен'}]);\r\n  }\r\n\r\n  controller.edit = async function(req, res) {\r\n    const params = req.body\r\n    if (!params.url) {\r\n      return res.status(400).json([{signup: false, message: 'Домен не передан'}]);\r\n    }\r\n    if (!params.id) {\r\n      return res.status(400).json([{signup: false, message: 'Id домена не передан'}]);\r\n    }\r\n    const { url, id } = params;\r\n\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n    user.domains.find((domain) => { return domain.id === id }).url = url;\r\n    await user.save();\r\n\r\n    return res.json([{ flag: true, message: 'Домен успешно изменен'}]);\r\n  }\r\n\r\n  controller.delete = async function(req, res) {\r\n\r\n    if (!req.params.id) {\r\n      return res.status(400).json([{signup: false, message: 'Id домена не передан'}]);\r\n    }\r\n    const { id } = req.params;\r\n\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n    user.domains = user.domains.filter((domain)=>{ return domain.id != id });\r\n    await user.save();\r\n\r\n    return res.json([{ flag: true, message: 'Домен успешно удален'}]);\r\n  }\r\n\r\n  controller.logs = async function(req, res) {\r\n    if (!req.params.domainId) {\r\n      return res.status(400).json([{signup: false, message: 'Id домена не передан'}]);\r\n    }\r\n    const { domainId } = req.params;\r\n    const userID = req.user.id;\r\n\r\n    const user = await User.findOne({id: userID});\r\n    if (!user) {\r\n      return res.status(400).json([{signup: false, message: 'Пользователь не найден'}]);\r\n    }\r\n    const domain = user.domains.find((domain) => (domain.id === domainId));\r\n    const { logs } = domain;\r\n\r\n    return res.json([{ flag: true, logs }]);\r\n  }\r\n\r\n  return controller\r\n}\r\n","import jwt from 'express-jwt'\r\nimport uniqid from 'uniqid';\r\n\r\n\r\nexport default (ctx) => {\r\n  const User = ctx.models.User;\r\n  const Channel = ctx.models.Channel;\r\n\r\n  let controller = {};\r\n\r\n  controller.getChannels = async function(req, res) {\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n\r\n    return res.json(user.channels);\r\n  }\r\n\r\n  controller.create = async function(req, res) {\r\n    const params = req.body;\r\n\r\n    if (!params.type) {\r\n      return res.status(400).json([{flag: false, message: 'type не передан'}]);\r\n    }\r\n    if (!params.endpoint) {\r\n      return res.status(400).json([{flag: false, message: 'endpoint не передан'}]);\r\n    }\r\n    const { type, endpoint } = params;\r\n\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n    const channel = new Channel({ id: uniqid(), type, endpoint })\r\n    user.channels.push(channel);\r\n    await user.save();\r\n\r\n    return res.json([{ flag: true, message: 'Channel успешно добавлен'}]);\r\n  }\r\n\r\n  controller.edit = async function(req, res) {\r\n    const params = req.body;\r\n\r\n    if (!params.type) {\r\n      return res.status(400).json([{flag: false, message: 'type не передан'}]);\r\n    }\r\n    if (!params.endpoint) {\r\n      return res.status(400).json([{flag: false, message: 'endpoint не передан'}]);\r\n    }\r\n    const { type, endpoint } = params;\r\n\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n    channel = user.channels.find((channel) => { return channel.id === id })\r\n    channel.type = type;\r\n    channel.endpoint = endpoint;\r\n    await user.save();\r\n\r\n    return res.json([{ flag: true, message: 'Канал успешно изменен'}]);\r\n  }\r\n\r\n  controller.delete = async function(req, res) {\r\n\r\n    if (!req.params.id) {\r\n      return res.status(400).json([{flag: false, message: 'Id канала не передан'}]);\r\n    }\r\n    const { id } = req.params;\r\n\r\n    const userID = req.user.id;\r\n    const user = await User.findOne({id: userID});\r\n    user.channels = user.channels.filter((channel)=>{ return channel.id != id });\r\n    await user.save();\r\n\r\n    return res.json([{ flag: true, message: 'Канал успешно удален'}]);\r\n  }\r\n\r\n\r\n\r\n  return controller\r\n}\r\n","import Auth from './Auth/Auth';\nimport Domain from './Domain/Domain';\nimport Channel from './Channel/Channel';\n\nexport default function () {\n  return {\n    Auth: Auth(...arguments),\n    Domain: Domain(...arguments),\n    Channel: Channel(...arguments),\n  }\n}\n","import nodemailer from 'nodemailer';\r\nimport smtpTransport from 'nodemailer-smtp-transport';\r\n\r\nexport default (ctx) => {\r\n  if (!ctx.log) throw '!log'\r\n\r\n  const transporter = nodemailer.createTransport(smtpTransport(ctx.config.nodemailer));\r\n\r\n  return  transporter;\r\n}\r\n","import Transporter from './Nodemailer/index';\r\n\r\nexport default function () {\r\n  return {\r\n    Transporter: Transporter(...arguments),\r\n  }\r\n}\r\n","import _ from 'lodash';\nimport mongoose from 'mongoose';\nimport { AsyncRouter } from 'express-async-router';\n\nexport default (ctx) => {\n  if (!_.has(ctx, 'controllers.Auth.signup')) throw '!controllers.Auth.signup'\n  if (!_.has(ctx, 'controllers.Auth.login')) throw '!controllers.Auth.login'\n  if (!_.has(ctx, 'controllers.Auth.validate')) throw '!controllers.Auth.validate'\n  if (!_.has(ctx, 'controllers.Auth.forgot')) throw '!controllers.Auth.forgot'\n  if (!_.has(ctx, 'controllers.Auth.checkForgotToken')) throw '!controllers.Auth.checkForgotToken'\n  if (!_.has(ctx, 'controllers.Auth.reset')) throw '!controllers.Auth.reset'\n\n\tconst api = AsyncRouter();\n\n  api.all('/validate', ctx.controllers.Auth.validate);\n  api.post('/signup', ctx.controllers.Auth.signup);\n  api.post('/login', ctx.controllers.Auth.login);\n  api.post('/forgot', ctx.controllers.Auth.forgot);\n  api.get('/forgot/:forgotEmailToken', ctx.controllers.Auth.checkForgotToken);\n  api.post('/reset', ctx.controllers.Auth.reset);\n\n\treturn api;\n}\n","import _ from 'lodash';\r\nimport mongoose from 'mongoose';\r\nimport { AsyncRouter } from 'express-async-router';\r\n\r\nexport default (ctx) => {\r\n  if (!_.has(ctx, 'controllers.Domain.domains')) throw '!controllers.Domain.domains'\r\n  if (!_.has(ctx, 'controllers.Domain.create')) throw '!controllers.Domain.create'\r\n  if (!_.has(ctx, 'controllers.Domain.delete')) throw '!controllers.Domain.delete'\r\n  if (!_.has(ctx, 'controllers.Domain.edit')) throw '!controllers.Domain.edit'\r\n  if (!_.has(ctx, 'controllers.Domain.logs')) throw '!controllers.Domain.logs'\r\n\r\n\tconst api = AsyncRouter();\r\n\r\n  api.get('/', ctx.controllers.Domain.domains);\r\n  api.post('/', ctx.controllers.Domain.create);\r\n  api.delete('/:id', ctx.controllers.Domain.delete);\r\n  api.put('/', ctx.controllers.Domain.edit);\r\n  api.get('/:domainId/logs', ctx.controllers.Domain.logs);\r\n\r\n\treturn api;\r\n}\r\n","import _ from 'lodash';\r\nimport mongoose from 'mongoose';\r\nimport { AsyncRouter } from 'express-async-router';\r\n\r\nexport default (ctx) => {\r\n  if (!_.has(ctx, 'controllers.Channel.getChannels')) throw '!controllers.Channel.getChannels'\r\n  if (!_.has(ctx, 'controllers.Channel.create')) throw '!controllers.Channel.create'\r\n\r\n\tconst api = AsyncRouter();\r\n\r\n  api.get('/', ctx.controllers.Channel.getChannels);\r\n  api.post('/', ctx.controllers.Channel.create);\r\n  api.put('/', ctx.controllers.Channel.edit);\r\n  api.delete('/:id', ctx.controllers.Channel.delete);\r\n\r\n\treturn api;\r\n}\r\n","import mongoose from 'mongoose';\nimport { AsyncRouter } from 'express-async-router';\nimport expressJwt from 'express-jwt';\nimport uniqid from 'uniqid';\nimport getAuth from './auth/auth';\nimport getDomain from './domain/domain';\nimport getChannel from './channel/channel';\n\nexport default (ctx) => {\n\tconst api = AsyncRouter();\n\n  api.all('/', () => ({ok: true, version: '1.0.1'}))\n\n  api.use('/auth', getAuth(ctx));\n\tapi.use('/domains', expressJwt({secret: ctx.config.jwt.secret}), getDomain(ctx));\n\tapi.use('/channels', expressJwt({secret: ctx.config.jwt.secret}), getChannel(ctx));\n\n\tapi.use('/', (err, req, res, next) => {\n\t\treturn res.status(401).json([{ flag: false, message: 'Не авторизован' }])\n\t})\n\n\treturn api;\n}\n","import bunyan from 'bunyan';\nimport express from 'express';\nimport mongoose from 'mongoose';\n\nimport getMiddlewares from './middlewares/index';\nimport getModels from './models/index';\nimport getControllers from './controllers/index';\nimport getUtils from './utils/index';\nimport getApi from './api/api';\n\nexport default class App {\n  constructor(params = {}) {\n    Object.assign(this, params);\n    if (!this.log) this.log = this.getLogger();\n    this.init();\n  }\n\n  getLogger(params) {\n    return bunyan.createLogger(Object.assign({\n      name: 'app',\n      src: __DEV__,\n      level: 'trace',\n    }, params))\n  }\n\n  getMiddlewares() {\n    return getMiddlewares(this);\n  }\n\n  getModels() {\n    return getModels(this);\n  }\n\n  getDatabase() {\n    return {\n      run: () => {\n        new Promise((resolve) => {\n          mongoose.connect(this.config.db.url);\n          resolve();\n        });\n      }\n    }\n  }\n\n  getControllers() {\n    return getControllers(this);\n  }\n\n  getUtils() {\n    return getUtils(this);\n  }\n\n  init() {\n    this.log.trace('App init');\n    this.app = express();\n    this.db = this.getDatabase();\n\n    this.utils = this.getUtils();\n    this.log.trace('utils', Object.keys(this.utils));\n\n    this.middlewares = this.getMiddlewares();\n    this.log.trace('middlewares', Object.keys(this.middlewares));\n\n    this.models = this.getModels();\n    this.log.trace('models', Object.keys(this.models));\n\n    this.controllers = this.getControllers();\n    this.log.trace('controllers', Object.keys(this.controllers));\n\n    this.useMiddlewares();\n    this.useRoutes();\n    this.useDefaultRoute();\n  }\n\n  useMiddlewares() {\n    this.app.use(this.middlewares.catchError);\n    this.app.use(this.middlewares.reqLog);\n    this.app.use(this.middlewares.accessLogger);\n    this.app.use(this.middlewares.reqParser);\n\n    this.app.use(this.controllers.Auth.parseToken);\n    this.app.use(this.controllers.Auth.parseUser);\n  }\n  useRoutes() {\n    const api = getApi(this);\n    this.app.use('/api/v1', api);\n  }\n  useDefaultRoute() {\n    this.app.use((req, res, next) => {\n      const err = ('Route not found');\n      next(err);\n    });\n  }\n\n  async run() {\n    this.log.trace('App run');\n    try {\n      await this.db.run();\n    } catch (err) {\n      this.log.fatal(err);\n    }\n    return new Promise((resolve) => {\n      this.app.listen(this.config.port, () => {\n        this.log.info(`App \"${this.config.name}\" running on port ${this.config.port}!`);\n        resolve(this);\n      });\n    });\n  }\n}\n","import config from './config/index';\nimport App from './App';\n\nconst app = new App({ config });\napp.run();\n"],"names":["global","__DEV__","__PROD__","levelFn","data","err","status","duration","logStart","leftPad","method","url","reqId","logFinish","time","toFixed","length","params","req","res","next","log","child","ws","host","headers","baseUrl","referer","header","ip","connection","remoteAddress","socket","debug","body","trace","hrtime","process","logging","statusCode","getHeader","diff","on","ctx","bodyParser","json","urlencoded","extended","cookieParser","cors","error","query","stack","uuid","v4","requests","forEach","val","key","bind","responses","accessLogger","arguments","reqParser","catchError","reqLog","extendReqRes","LogSchema","mongoose","Schema","String","DomainSchema","ChannelSchema","bcryptGenSalt","Promise","promisify","bcrypt","genSalt","bcryptHash","hash","bcryptCompare","compare","schema","statics","isValidEmail","email","re","test","generatePassword","Math","random","toString","substr","methods","toJSON","_","omit","toObject","getIdentity","object","pick","generateAuthToken","jwt","sign","config","secret","verifyPassword","password","SALT_WORK_FACTOR","pre","isModified","then","salt","catch","model","Number","Domain","Rate","User","Token","Channel","models","transporter","utils","Transporter","controller","validate","user","findOne","id","message","getUserFields","validationUserFields","userFields","valid","captcha","isValid","signup","getUserCriteria","criteria","existUser","uniqid","channel","save","userID","forgotEmailToken","userToken","result","login","forgot","crypto","randomBytes","token","siteUrl","mailText","sendMail","mailOptions","checkForgotToken","reset","checkPassword","getToken","authorization","split","cookies","devToken","parseToken","parseUser","options","_errJwt","isAuth","_id","send","domains","create","channels","push","domain","flag","edit","find","delete","filter","logs","domainId","getChannels","type","endpoint","Auth","nodemailer","createTransport","smtpTransport","has","api","AsyncRouter","all","controllers","post","get","put","ok","version","use","getAuth","expressJwt","getDomain","getChannel","App","getLogger","init","bunyan","createLogger","getMiddlewares","getModels","resolve","connect","db","getControllers","getUtils","app","express","getDatabase","middlewares","useMiddlewares","useRoutes","useDefaultRoute","getApi","run","fatal","listen","port","info","name"],"mappings":"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"}